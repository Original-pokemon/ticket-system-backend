generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

model Group {
  id          String @id
  description String
  users       User[]

  @@map("groups")
}

model Bush {
  id              String          @id
  description     String
  managers        Manager[]
  petrol_stations PetrolStation[]
  task_performers TaskPerformer[]

  @@map("bushes")
}

model User {
  id               String          @id
  user_name        String
  first_name       String
  last_name        String?
  user_group       String
  group            Group           @relation(fields: [user_group], references: [id])
  task_performer   TaskPerformer?
  manager          Manager?
  petrol_station   PetrolStation?
  comments         Comment[]
  status_histories StatusHistory[]
  created_at       DateTime        @default(now())

  @@map("users")
}

model Manager {
  id              String          @id
  user            User            @relation(fields: [id], references: [id])
  bush_id         String?
  bush            Bush?           @relation(fields: [bush_id], references: [id])
  petrol_stations PetrolStation[]

  @@map("managers")
}

model PetrolStation {
  id       String    @id
  user     User      @relation(fields: [id], references: [id])
  managers Manager[]
  bush_id  String?
  bush     Bush?     @relation(fields: [bush_id], references: [id])
  tickets  Ticket[]

  @@map("petrol_stations")
}

model Category {
  id              String          @id
  description     String
  tickets         Ticket[]
  words           TagWord[]
  task_performers TaskPerformer[]

  @@map("categores")
}

model TaskPerformer {
  id          String    @id
  user        User      @relation(fields: [id], references: [id])
  bush_id     String
  bush        Bush      @relation(fields: [bush_id], references: [id])
  category_id String?
  category    Category? @relation(fields: [category_id], references: [id])

  @@map("task_performers")
}

model Priority {
  id          String    @id
  description String
  tickets     Ticket[]
  tag_words   TagWord[]

  @@map("priorites")
}

model Status {
  id               String          @id
  description      String
  status_histories StatusHistory[]
  tickets          Ticket[]

  @@map("statuses")
}

model Ticket {
  id                String          @id @default(uuid())
  title             String
  ticket_category   String?
  ticket_priority   String?
  description       String
  petrol_station_id String
  status_id         String
  created_at        DateTime        @default(now())
  deadline          DateTime?
  attachments       Attachment[]
  comments          Comment[]
  status_history    StatusHistory[]
  petrol_station    PetrolStation   @relation(fields: [petrol_station_id], references: [id])
  status            Status          @relation(fields: [status_id], references: [id])
  category          Category?       @relation(fields: [ticket_category], references: [id])
  priority          Priority?       @relation(fields: [ticket_priority], references: [id])

  @@map("tickets")
}

model StatusHistory {
  id            String   @id @default(uuid())
  ticket_id     String
  ticket        Ticket   @relation(fields: [ticket_id], references: [id])
  user_id       String
  user          User     @relation(fields: [user_id], references: [id])
  ticket_status String
  status        Status   @relation(fields: [ticket_status], references: [id])
  created_at    DateTime @default(now())

  @@map("status_histories")
}

model Comment {
  id          String       @id @default(uuid())
  ticket_id   String
  ticket      Ticket       @relation(fields: [ticket_id], references: [id])
  user_id     String
  user        User         @relation(fields: [user_id], references: [id])
  text        String
  attachments Attachment[]
  created_at  DateTime     @default(now())

  @@map("comments")
}

model Attachment {
  id         String   @id @default(uuid())
  ticket_id  String?
  ticket     Ticket?  @relation(fields: [ticket_id], references: [id])
  comment_id String?
  comment    Comment? @relation(fields: [comment_id], references: [id])
  path       String

  @@map("attachments")
}

model TagWord {
  id          String   @id
  category_id String
  category    Category @relation(fields: [category_id], references: [id])
  priority_id String
  priority    Priority @relation(fields: [priority_id], references: [id])

  @@map("tag_words")
}
